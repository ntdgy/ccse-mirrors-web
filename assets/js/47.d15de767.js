(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{510:function(t,s,a){"use strict";a.r(s);var r=a(11),e=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"aosp-mirror"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aosp-mirror"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"/AOSP"}},[t._v("AOSP")]),t._v(" Mirror")]),t._v(" "),s("p",[s("strong",[t._v("注意: 本镜像是 AOSP 镜像，Android SDK因版权原因，我们不能提供镜像服务。")])]),t._v(" "),s("p",[s("strong",[t._v("可访问 "),s("a",{attrs:{href:"https://cs.android.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://cs.android.com"),s("OutboundLink")],1),t._v(" 或 https://github.com/aosp-mirror 在线搜索及浏览 AOSP 源码。")])]),t._v(" "),s("p",[t._v("参考 Google 教程 https://source.android.com/setup/build/downloading， 将 "),s("code",[t._v("https://android.googlesource.com/")]),t._v(" 全部使用 "),s("code",[t._v("https://mirrors.sustech.edu.cn/AOSP/")]),t._v(" 代替即可。")]),t._v(" "),s("p",[t._v("由于使用 HTTPS 协议更安全，并且更便于我们灵活处理，所以强烈推荐使用 HTTPS 协议同步 AOSP 镜像。")]),t._v(" "),s("h2",{attrs:{id:"过程摘录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#过程摘录"}},[t._v("#")]),t._v(" 过程摘录")]),t._v(" "),s("p",[t._v("(参考 https://lug.ustc.edu.cn/wiki/mirrors/help/aosp 编写)")]),t._v(" "),s("p",[t._v("下载 repo 工具:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" ~/bin\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=~")]),t._v("/bin:"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" https://storage.googleapis.com/git-repo-downloads/repo "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ~/bin/repo\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" a+x ~/bin/repo\n")])])]),s("p",[t._v("或者使用tuna的"),s("a",{attrs:{href:"https://mirrors.tuna.tsinghua.edu.cn/help/git-repo/",target:"_blank",rel:"noopener noreferrer"}},[t._v("git-repo镜像"),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"使用每月更新的初始化包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用每月更新的初始化包"}},[t._v("#")]),t._v(" 使用每月更新的初始化包")]),t._v(" "),s("p",[t._v("由于首次同步需要下载约 95GB 数据，过程中任何网络故障都可能造成同步失败，我们强烈建议您使用初始化包进行初始化。")]),t._v(" "),s("p",[t._v("下载 https://mirrors.tuna.tsinghua.edu.cn/aosp-monthly/aosp-latest.tar，下载完成后记得根据 checksum.txt 的内容校验一下。")]),t._v(" "),s("p",[t._v("由于所有代码都是从隐藏的 "),s("code",[t._v(".repo")]),t._v(" 目录中 checkout 出来的，所以我们只保留了 "),s("code",[t._v(".repo")]),t._v(" 目录，下载后解压 再 "),s("code",[t._v("repo sync")]),t._v(" 一遍即可得到完整的目录。")]),t._v(" "),s("p",[t._v("使用方法如下:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" -c https://mirrors.tuna.tsinghua.edu.cn/aosp-monthly/aosp-latest.tar "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载初始化包")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" xf aosp-latest.tar\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" AOSP   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 解压得到的 AOSP 工程目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这时 ls 的话什么也看不到，因为只有一个隐藏的 .repo 目录")]),t._v("\nrepo "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 正常同步一遍即可得到完整目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或 repo sync -l 仅checkout代码")]),t._v("\n")])])]),s("p",[t._v("此后，每次只需运行 "),s("code",[t._v("repo sync")]),t._v(" 即可保持同步。 "),s("strong",[t._v("我们强烈建议您保持每天同步，并尽量选择凌晨等低峰时间")])]),t._v(" "),s("h4",{attrs:{id:"传统初始化方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#传统初始化方法"}},[t._v("#")]),t._v(" 传统初始化方法")]),t._v(" "),s("p",[t._v("建立工作目录:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" WORKING_DIRECTORY\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" WORKING_DIRECTORY\n")])])]),s("p",[t._v("初始化仓库:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("repo init -u https://mirrors.sustech.edu.cn/AOSP/platform/manifest\n")])])]),s("p",[s("strong",[t._v("如果提示无法连接到 gerrit.googlesource.com，请参照"),s("a",{attrs:{href:"https://mirrors.tuna.tsinghua.edu.cn/help/git-repo",target:"_blank",rel:"noopener noreferrer"}},[t._v("git-repo的帮助页面"),s("OutboundLink")],1),t._v("的更新一节。")])]),t._v(" "),s("p",[t._v("如果需要某个特定的 Android 版本("),s("a",{attrs:{href:"https://source.android.com/setup/start/build-numbers#source-code-tags-and-builds",target:"_blank",rel:"noopener noreferrer"}},[t._v("列表"),s("OutboundLink")],1),t._v(")：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("repo init -u https://mirrors.sustech.edu.cn/AOSP/platform/manifest/AOSP/platform/manifest -b android-4.0.1_r1\n")])])]),s("p",[t._v("同步源码树（以后只需执行这条命令来同步）：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("repo "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),t._v("\n")])])]),s("h3",{attrs:{id:"建立次级镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#建立次级镜像"}},[t._v("#")]),t._v(" 建立次级镜像")]),t._v(" "),s("p",[t._v("由于 AOSP 镜像需求量巨大，且 Git 服务占资源较多，TUNA 服务器因 AOSP 产生的负载已经占主要部分。 如果你是团队用户，我们强烈建议你通过 TUNA 建立次级镜像，再分享给团队内其他用户，减轻 TUNA 服务器压力。 建立 AOSP 镜像需要占用约 460G 磁盘。")]),t._v(" "),s("p",[t._v("具体步骤为:")]),t._v(" "),s("p",[t._v("下载 "),s("code",[t._v("repo")]),t._v(" 工具和建立工作目录（略）")]),t._v(" "),s("p",[t._v("初始化:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("repo init -u https://mirrors.sustech.edu.cn/AOSP/mirror/manifest --mirror\n")])])]),s("p",[t._v("最后同步源码树:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("repo sync\n")])])]),s("p",[t._v("同步完成后，运行 "),s("code",[t._v("git daemon --verbose --export-all --base-path=WORKING_DIR WORKING_DIR")]),t._v(" ("),s("code",[t._v("WORKING_DIR")]),t._v("为代码树所在目录) 。")]),t._v(" "),s("p",[t._v("此后，其他用户使用 "),s("code",[t._v("git://ip.to.mirror/")]),t._v(" 作为镜像即可。")]),t._v(" "),s("h3",{attrs:{id:"替换已有的-aosp-源代码的-remote"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#替换已有的-aosp-源代码的-remote"}},[t._v("#")]),t._v(" 替换已有的 AOSP 源代码的 remote")]),t._v(" "),s("p",[t._v("如果你之前已经通过某种途径获得了 AOSP 的源码(或者你只是 init 这一步完成后)， 你希望以后通过 TUNA 同步 AOSP 部分的代码，只需要修改 "),s("code",[t._v(".repo/manifests.git/config")]),t._v("，将")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("url = https://android.googlesource.com/platform/manifest\n")])])]),s("p",[t._v("更改为")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("url = https://mirrors.sustech.edu.cn/AOSP/platform/manifest\n")])])]),s("p",[t._v("或者可以不修改文件，而执行")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("git config --global url.https://mirrors.sustech.edu.cn/AOSP/.insteadof https://android.googlesource.com\n")])])]),s("h3",{attrs:{id:"faq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#faq"}},[t._v("#")]),t._v(" FAQ")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("镜像的是什么？")]),t._v(" "),s("ul",[s("li",[t._v("AOSP 的 git 仓库")])])]),t._v(" "),s("li",[s("p",[t._v("为何不能通过浏览器访问？")]),t._v(" "),s("ul",[s("li",[t._v("暂时没有 gitweb, 而且反正是 git bare 仓库，没有可以直接看到的内容。")]),t._v(" "),s("li",[t._v("建议访问 "),s("a",{attrs:{href:"https://cs.android.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://cs.android.com"),s("OutboundLink")],1),t._v(" 或 https://github.com/aosp-mirror 在线搜索及浏览 AOSP 源码。")])])]),t._v(" "),s("li",[s("p",[t._v("出现")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("curl: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" The requested URL returned error: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),t._v(" Not Found Server does not provide clone.bundle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" ignoring.\n")])])]),s("p",[t._v("怎么办？")]),t._v(" "),s("ul",[s("li",[t._v("无视即可。")]),t._v(" "),s("li",[t._v("参见：https://github.com/tuna/issues/issues/936")])])])]),t._v(" "),s("h3",{attrs:{id:"参考文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[t._v("#")]),t._v(" 参考文档")]),t._v(" "),s("ul",[s("li",[t._v("AOSP帮助/TUNA："),s("a",{attrs:{href:"https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);